@using DbLayer.Repository
@using DAL
@using StoreOrderingDashBoard.Models
@{
    string storename = SessionValues.Name != null ? SessionValues.Name : "store";
    MenuRepository menu = new MenuRepository();
    CustomerRepository customerRepository = new CustomerRepository();
    string MkrChkrFlag = "";
    int storeid = 0;
    int planid = 0;
    int custid = 0;
    int userid = 0;
    Customer SessionCustomer = new Customer();
    int storeId = SessionValues.StoreId;
    int UserId = SessionValues.UserId;
    if (storename != "store")
    {
        storeid = SessionValues.StoreId;
        planid = SessionValues.PlanId;
        custid = SessionValues.LoggedInCustId.Value;
        userid = SessionValues.UserId;
        MkrChkrFlag = SessionValues.MkrChkrFlag;
        SessionCustomer = customerRepository.GetCustomerContextById(custid);
    }

    var menus = MenuManagement.StoreParentMenu;
    //var menus = menu.ParentmenuStore(1, planid, custid, userid);
}
@functions {
    public int PopupShowDelay
    {
        get
        {
            return 1000 * (Convert.ToInt32(Convert.ToInt32(SessionValues.SessionTimeOutStore)) - 130);
        }
    }
}


<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title-OrderXpro</title>
    <!-- Bootstrap -->

    <link href="~/Content/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="~/Content/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="~/Content/vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="~/Content/vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!--Data Table-->
    <link href="~/Content/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap-progressbar -->
    <link href="~/Content/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <!-- JQVMap -->
    <link href="~/Content/vendors/jqvmap/dist/jqvmap.min.css" rel="stylesheet" />
    <!-- bootstrap-daterangepicker -->
    <link href="~/Content/vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <link href="~/Content/vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <link href="~/Content/vendors/switchery/dist/switchery.min.css" rel="stylesheet">
    <!--Boostrap multiselect-->
    <link href="~/Content/build/css/bootstrap-multiselect.css" rel="stylesheet" />
    <!-- Custom Theme Style -->
    <link href="~/Content/build/css/custom.css" rel="stylesheet">
    @*<link href="~/Content/build/css/custom_dark.css" rel="stylesheet">*@
    <style>
        .datatable-btn {
            padding: 2px 12px !important;
            margin: 0px;
        }

        .list-group-item {
            position: relative;
            display: block;
            padding: 0.75rem 1.25rem;
            margin-bottom: -1px;
            background-color: #fff;
            border: 1px solid rgba(0, 0, 0, 0.125)
        }

        .list-group {
            display: flex;
            flex-direction: column;
            padding-left: 0;
            margin-bottom: 0
        }

        .todo-indicator {
            position: absolute;
            width: 4px;
            height: 60%;
            border-radius: 0.3rem;
            left: 0.625rem;
            top: 20%;
            opacity: .6;
            transition: opacity .2s
        }

        .bg-warning {
            background-color: #f7b924 !important
        }

        .widget-content {
            padding: 1rem;
            flex-direction: row;
            align-items: center
        }

            .widget-content .widget-content-wrapper {
                display: flex;
                flex: 1;
                position: relative;
                align-items: center
            }

            .widget-content .widget-content-right.widget-content-actions {
                visibility: hidden;
                opacity: 0;
                transition: opacity .2s
            }

            .widget-content .widget-content-right {
                margin-left: auto
            }

        .btn:not(:disabled):not(.disabled) {
            cursor: pointer
        }

        .btn {
            position: relative;
            transition: color 0.15s, background-color 0.15s, border-color 0.15s, box-shadow 0.15s
        }

        .btn-outline-success {
            color: #3ac47d;
            border-color: #3ac47d
        }

        .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            right: 0;
            background-color: #144069;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }

            .sidebar a {
                padding: 8px 8px 8px 32px;
                text-decoration: none;
                font-size: 25px;
                color: #818181;
                display: block;
                transition: 0.3s;
            }

                .sidebar a:hover {
                    color: #f1f1f1;
                }

            .sidebar .closebtn {
                position: absolute;
                top: 0;
                right: 25px;
                font-size: 36px;
                margin-left: 50px;
            }

        #main {
            transition: margin-left .5s;
            padding: 16px;
        }

        .nav-md .smallLogo {
            display: none !important;
        }

        .nav-sm .bigLogo {
            display: none !important;
        }
    </style>
</head>
<body class="nav-sm footer_fixed">
    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0;background: #ededed;border-bottom: 1px solid #ededed;">
                        <a href="@Url.Action("Home","Store")" class="site_title">
                            <img class="smallLogo logo" src="/images/OrderXPro-3.png" style="margin-left:auto;display:block;margin-right:auto;height: 44px;width:auto;margin-top: 7px;">
                            <img class="bigLogo logo" src="/images/OrderXPro-2.png" style="margin-left:auto;display:block;margin-right:auto;height: 44px;width:auto;margin-top: 7px;">
                        </a>
                    </div>
                    <div class="clearfix"></div>
                    <!-- menu profile quick info -->
                    <div class="profile clearfix">
                        <div class="profile_pic">
                            <img src="data:image/jpeg;base64,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" alt="..." class="img-circle profile_img">
                        </div>
                        <div class="profile_info">
                            <span>Welcome,</span>
                            <h2>@storename</h2>
                        </div>
                    </div>
                    <!-- /menu profile quick info -->
                    <br />
                    <!-- sidebar menu -->
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                        <div class="menu_section">
                            <h3>General</h3>
                            <ul class="nav side-menu">
                                @if (menus.Count() > 0)
                                {
                                    foreach (Menu item in menus)
                                    {
                                        <li>
                                            <a><i class="@item.Fa"></i> @item.MenuName <span class="fa fa-chevron-down"></span></a>
                                            @{
                                                //var submenu = menu.ChildmenuStore(item.Id, 1, storeid,planid);
                                                var submenu = MenuManagement.SubStoreMenu(item.Id, 1);
                                            }
                                            @if (submenu.Count() > 0)
                                            {
                                                <ul class="nav child_menu">
                                                    @foreach (Menu item1 in submenu)
                                                    {

                                                        <li>
                                                            @if (item1.ControllerName != null && item1.ActionName != null)
                                                            {
                                                                <a href="@Url.Action(item1.ActionName,item1.ControllerName)">@item1.MenuName</a>
                                                            }
                                                            else
                                                            {
                                                                <a href="#">@item1.MenuName</a>
                                                            }
                                                            @*@{
                                                                    //var submenuchild = menu.ChildmenuStore(item1.Id, 1, storeid, planid);
                                                                    var submenuchild = menu.ChildmenuStore(item1.Id, 1, userid, planid);
                                                                }
                                                                @if (submenuchild.Count() > 0)
                                                                {
                                                                    <ul class="nav child_menu">
                                                                        @foreach (Menu item2 in submenuchild)
                                                                        {
                                                                            <li>
                                                                                <a href="@Url.Action(item2.ActionName,item2.ControllerName)">@item2.MenuName</a>
                                                                            </li>
                                                                        }
                                                                    </ul>
                                                                }*@
                                                        </li>

                                                    }


                                                </ul>
                                            }

                                        </li>
                                    }
                                }
                            </ul>

                            @Html.AntiForgeryToken();
                        </div>

                    </div>
                    <!-- /sidebar menu -->
                    <!-- /menu footer buttons -->
                    <div class="sidebar-footer hidden-small">

                        <a data-toggle="tooltip" data-placement="top" title="Logout" href="@Url.Action("LogOut","Store")">
                            <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                        </a>
                    </div>
                    <!-- /menu footer buttons -->
                </div>
            </div>

            <div class="top_nav">
                <div class="nav_menu">
                    <nav>
                        <div class="nav toggle">
                            <a id="menu_toggle" style="padding-top:0px;">
                                <i class="fa fa-bars"></i>
                            </a>

                        </div>
                        <ul class="nav navbar-nav navbar-right">
                            <li class="">
                                <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="padding: 3px;">
                                    <img src="@("/images/Customer/"+(SessionCustomer != null ? SessionCustomer.Name+".jpg" : "Default"))" style="height: 50px;width: auto; border-radius: 2px;" onerror="this.src='/images/Customer/no-image.png'; ">@(SessionCustomer != null ? SessionCustomer.Name : "")
                                    <span class=" fa fa-angle-down"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-usermenu pull-right">
                                    <li><a href="@Url.Action("LogOut","Store")"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                                </ul>
                            </li>
                            @if (MkrChkrFlag != "Chkr")
                            {
                                <li role="presentation" class="dropdown" style="padding-top: 7px;padding-bottom: 7px;margin: 0px 2px;">
                                    <button onclick="window.location = '@Url.Action("OrderNew", "Order")' " href="@Url.Action("OrderNew","Order")" class=" btn btn-primary" style="height:37px;">
                                        Create New Order
                                    </button>
                                </li>
                            }
                            <li role="presentation" class="dropdown" style="padding-top: 7px;">
                                <button onclick="ViewOrder()" class="btn btn-info" style="">
                                    Pending Finalize  <span class="badge badge-light" id="Pending_Finalize_Count" style="font-size: 16px; background:#ffc107;color:#212529; ">_</span>
                                </button>
                            </li>
                            <div class="modal fade" id="ViewDraftModal" role="dialog">
                                <div class="modal-dialog modal-lg">
                                    <!-- Modal content-->
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title">Order Summary</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-12 col-sm-12 col-xs-12">
                                                    <div class="x_panel">
                                                        <div class="x_content">
                                                            <table id="DraftOrderTable" class="table table-striped table-bordered">
                                                                <thead>
                                                                    <tr>
                                                                        @*<th>Product ID</th>*@
                                                                        <th>SKU Code</th>
                                                                        <th>SKU Description</th>
                                                                        <th>SKU Category</th>
                                                                        <th>UOM</th>
                                                                        <th>MOQ</th>
                                                                        <th>Case Size</th>
                                                                        <th>Quantity</th>
                                                                        <th>Edit</th>
                                                                        <th>Delete</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                            </table>
                                                            <div class="loader"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <div class="buttons">
                                                <!-- Standard button -->
                                                <div class="row">
                                                    <div class="col-md-4 col-sm-4 col-xs-12">
                                                        <input type="button" class="btn btn-danger pull-left" id="Delete" onclick="DeleteDraft(@UserId)" value="Delete Draft" />
                                                    </div>
                                                    <div class="col-md-4 col-sm-4 col-xs-12 pull-right input-group">
                                                        <input type="text" placeholder="CUSTOMER PO NO" value="" id="txtPONumber" class="form-control" style="width: 200px;">
                                                        <button type="button" onclick="Finilize(@storeId)" id="Finalisebtn" class="btn btn-primary">Finalise</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </ul>
                    </nav>
                </div>
            </div>
            <!-- /top navigation -->
            <!-- page content -->
            @RenderBody()
            <!-- /page content -->
            <!-- footer content -->
            <footer>
                <div class="text-center">
                    Copyright @(DateTime.Now.Year - 1) - @DateTime.Now.Year © Radhakrishna Foodland Pvt Ltd.
                </div>
                <div class="clearfix"></div>
            </footer>
            <!-- /footer content -->
        </div>
    </div>
    <!-- jQuery -->
    <script src="~/Content/vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="~/Content/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="~/Content/vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="~/Content/vendors/nprogress/nprogress.js"></script>
    <!-- Chart.js -->
    <script src="~/Content/vendors/Chart.js/dist/Chart.min.js"></script>
    <!-- gauge.js -->
    <script src="~/Content/vendors/gauge.js/dist/gauge.min.js"></script>
    <!-- bootstrap-progressbar -->
    <script src="~/Content/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <!-- iCheck -->
    <script src="~/Content/vendors/iCheck/icheck.min.js"></script>
    <!-- Skycons -->
    <script src="~/Content/vendors/skycons/skycons.js"></script>
    <!-- Flot -->
    <script src="~/Content/vendors/Flot/jquery.flot.js"></script>
    <script src="~/Content/vendors/Flot/jquery.flot.pie.js"></script>
    <script src="~/Content/vendors/Flot/jquery.flot.time.js"></script>
    <script src="~/Content/vendors/Flot/jquery.flot.stack.js"></script>
    <script src="~/Content/vendors/Flot/jquery.flot.resize.js"></script>
    <!-- Flot plugins -->
    <script src="~/Content/vendors/flot.orderbars/js/jquery.flot.orderBars.js"></script>
    <script src="~/Content/vendors/flot-spline/js/jquery.flot.spline.min.js"></script>
    <script src="~/Content/vendors/flot.curvedlines/curvedLines.js"></script>
    <!-- DateJS -->
    <script src="~/Content/vendors/DateJS/build/date.js"></script>
    <!--Data Table-->
    <script src="~/Content/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    @*<script src="~/Content/vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>*@
    <script src="~/Content/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="~/Content/vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
    @*<script src="~/Content/vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>*@
    <script src="~/Content/vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="~/Content/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
    <script src="~/Content/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="~/Content/vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/Content/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
    <script src="~/Content/vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
    @*<script src="~/Content/vendors/jszip/dist/jszip.min.js"></script>*@
    <script src="~/Content/vendors/pdfmake/build/pdfmake.min.js"></script>
    <script src="~/Content/vendors/pdfmake/build/vfs_fonts.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>
    <!-- JQVMap -->
    <script src="~/Content/vendors/jqvmap/dist/jquery.vmap.js"></script>
    <script src="~/Content/vendors/jqvmap/dist/maps/jquery.vmap.world.js"></script>
    <script src="~/Content/vendors/jqvmap/examples/js/jquery.vmap.sampledata.js"></script>
    <script src="~/Content/vendors/switchery/dist/switchery.min.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="~/Content/vendors/moment/min/moment.min.js"></script>
    <script src="~/Content/vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
    <script src="~/Content/vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <!-- ECharts -->
    <script src="~/Content/vendors/echarts/dist/echarts.min.js"></script>
    <script src="~/Content/vendors/echarts/map/js/world.js"></script>
    <!-- Boostrap Multiselect-->
    <script src="~/Content/build/js/bootstrap-multiselect.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="~/Content/build/js/custom.js"></script>
</body>
</html>

<script>
     var loginUrl='@Url.Action("LogIn", "Store" , new { IsSessionExpired = 'Y' })';
    $(function () {
        $("body").on('click keypress', function () {
            ResetThisSession();
        });
    });
    var timeInSecondsAfterSessionOut = 1800; // change this to change session time out (in seconds).
    var secondTick = 0;
    function ResetThisSession() {
        secondTick = 0;
    }
    function StartThisSessionTimer() {
        secondTick++;
        var timeLeft = ((timeInSecondsAfterSessionOut - secondTick) / 60).toFixed(0); // in minutes
        timeLeft = timeInSecondsAfterSessionOut - secondTick; // override, we have 30 secs only
        $("#spanTimeLeft").html(timeLeft);
        if (secondTick > timeInSecondsAfterSessionOut) {
            clearTimeout(tick);
           // window.location = "/Logout.aspx";
            document.location = loginUrl;
            return;
        }
        tick = setTimeout("StartThisSessionTimer()", 1000);
    }
    $(document).ready(function () {
        StartThisSessionTimer();
    });
</script>
<script id="ViewDraftSrcipt">
    $(document).ready(function () {
        GetDraftCount();
    });
    function ViewOrder() {
        $('#ViewDraftModal').modal("show");
        $(".modal-content").show();
        LoadModalData();
    }
    var table;
     function LoadModalData(){
         if ($.fn.dataTable.isDataTable('#DraftOrderTable')) {
            table.destroy();
        }
         table = $("#DraftOrderTable").DataTable({
                         "ajax": {
                            "url": '@Url.Action("GetDraftOrder", "Order")',
                            "type": "Get",
                            "dataType": "JSON",
                         },
                        "ordering": true,
                        "order": [[1, "asc"]],
                        "columns": [
                            {
                                "data": "Item Code", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return  row.Item_Code;
                                }
                            },
                            {
                                "data": "Item Name", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return  row.Item_Desc ;
                                }
                            },
                            {
                                "data": "Category", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return  row.CaseConversion  ;
                                }
                            },
                            {
                                "data": "UOM", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return row.UnitofMasureDescription;

                                }
                            },
                            {
                                "data": "MOQ", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return row.MinimumOrderQuantity ;
                                }
                            },
                            {
                                "data": "Case Size", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return row.CaseSize;
                                }
                            },
                            {
                                "data": "Quantity", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return "<input type='number' id='Qtys" + row.Id + "'  min='0'  step='" + row.MinimumOrderQuantity + "' onblur='CheckQtys(" + row.MinimumOrderQuantity + "," + row.Id + "," + row.Ordered_Qty + "," + row.ItemId + "," + row.MaximumOrderLimit + "," + parseInt(row.CaseSize) + ",\"" + row.UnitofMasureDescription +"\" )' value=" + row.Ordered_Qty + " class='form-control input-sm qty-5' disabled/>";
                                }
                            },
                            {
                                "data": "Edit", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return "<button id='Edit" + row.Id + "' class='btn btn-sm btn-success' onclick='Editbutton(" + row.Id + ")'>Edit</button>";
                                }
                            },
                            {
                                "data": "Delete", "autoWidth": true,
                                render: function (data, type, row, meta) {
                                    return "<button id='Delete" + row.Id + "' class='btn btn-sm btn-danger' onclick='DeleteItem(" + row.ItemId + ")' >Delete</button >";
                                }
                            }
                            ],
                        "paging": true,
             "searching": true,
             "initComplete": function (settings, json) {
                 if (json.data.length > 0) {
                     let data = json.data[0]
                     if (data != null && data.PONumber != null && data.PONumber != "" && data.PONumber != undefined) {
                         $('#txtPONumber').val(data.PONumber);
                         $("#txtPONumber").prop("readonly", "readonly");
                     }
                 }
                 //alert('DataTables has finished its initialisation.');
             }
         });
         @*$.ajax
             ({
                 type: "Get",
                 url: "@Url.Action("GetPONumber","Order")",
                 success: function (result) {
                     if (result != null && result.PoNumber != null && result.PoNumber != "" && result.PoNumber  != undefined) {
                         $('#txtPONumber').val(result.PoNumber);
                         $("#txtPONumber").prop("readonly", "readonly");
                     }
                     
                 }
             });*@
        $(".loader").hide();
    }
    function Finilize(storeId) {
        $(".loader").show();
        $('#Finalise').prop('disabled', true);
        $('#Item').prop('disabled', true);
        $('#Delete').prop('disabled', true);
        var PONumber = $('#txtPONumber').val()
            productlist = [];
            var tableinfo = table.page.info();
        total = tableinfo.recordsTotal
        var RToken=$("__RequestVerificationToken").val();
            for (i = 0; i < total; i++) {
                var data = table.cell(i, 6).nodes().to$().find('input').val()
                if (parseInt(data) > 0) {
                    var da = table.row(i).data();
                    var product = {};
                    product.ProductId = parseInt(da.ItemId);
                    product.Qty = data;
                    product.OrderheaderId = parseInt(storeId);
                    product.ItemCode = da.Item_Code;
                    product.ItemDesc = da.Item_Desc;
                    product.PONumber = PONumber;
                    productlist.push(product);
                }
            }
            var r = confirm("Are You Sure You Want To Finalise?");
            if (r) {
                $.ajax({
                    url: "@Url.Action("FinilizeDraft", "Order")",
                    type: "POST",
                    data: {
                        "order": productlist,
                        "issave": "Finilize"
                    },
                    success: function (response) {
                        var Errors = [];
                        var obj = response;
                                var isfulluploaded = true;
                                $.each(obj, function (key, value) {
                                    if (value.Status != 1) {
                                        console.log(value);
                                        isfulluploaded = false;
                                        Errors.push(value);

                                    }
                                });
                                if (isfulluploaded){
                                    $("#errorlog").hide();
                                    $('#ViewDraftModal').modal('hide');
                                    alert("ORDER UPLOADED SUCCESSFULLY");
                                    $(".modal-content").hide();
                                    window.location = "@Url.Action("Home", "Store")";
                                }
                                else {
                                    $("#errorlog").show();
                                    $('#ViewDraftModal').modal('hide');
                                    if (response.length != Errors.length) {
                                        alert("ORDER UPLOADED PARTIALLY.\n PLEASE CHECK ERROR LOG");
                                        redirectPost('@Url.Action("OrderNew","Order")', Errors, RToken);
                                    }
                                    else {
                                        alert("UNABLE TO UPLOAD ORDER.\n PLEASE CHECK ERROR LOG");
                                        redirectPost('@Url.Action("OrderNew","Order")', Errors, RToken);
                                    }
                                    $(".modal-content").hide();
                                }
                        $(".loader").hide();
                        $('#Finalise').prop('disabled', false);
                        $('#Item').prop('disabled', false);
                        $('#Delete').prop('disabled', false);
                    }
                });
            }
            else {
                $(".loader").hide();
                $('#Finalise').prop('disabled', false);
                $('#Item').prop('disabled', false);
                $('#Delete').prop('disabled', false);
            }
    }
    function DeleteItem(ItemId){
            var r = confirm("Are You Sure You Want To Delete?");
            if (r) {
                $(".loader").show();
                $('#Finalise').prop('disabled', true);
                $('#Item').prop('disabled', true);
                $('#Delete').prop('disabled', true);
                $.ajax({
                    url: "@Url.Action("DeleteDraftItem", "Order")",
                    type: "POST",
                    data: {
                        "ItemId": ItemId
                    },
                    success: function (response) {
                        if (response) {
                            alert("ITEM DELETED SUCCESSFULLY");
                            //window.location.reload();
                            LoadModalData();
                            GetDraftCount();
                            $(".loader").hide();
                            $('#Finalise').prop('disabled', false);
                            $('#Item').prop('disabled', false);
                            $('#Delete').prop('disabled', false);
                        }
                    }
                });
            }
    }

    function DeleteDraft(UserId)
    {
             var r = confirm("Are You Sure You Want To Delete?");
            if (r) {
                $.ajax({
                    url: "@Url.Action("DeleteDraft", "Order")",
                    type: "POST",
                    data: {
                        "UserId": UserId
                    },
                    success: function (response) {
                        if (response) {
                            alert("Order Deleted.");
                            window.location = "@Url.Action("Home", "Store")"
                        }
                    }
                });
            }
    }
    function GetDraftCount() {
        $("#Pending_Finalize_Count").val();
        $.ajax({
                url: "@Url.Action("GetDraftOrder", "Order")",
                type: "Get",
                success: function (response) {
                    if (response) {
                        $("#Pending_Finalize_Count").text(response.data.length);
                    }
                }
            });
    }
    function CheckQtys(MinimumOrderQuantity, e1, OriginalQuantity, ItemId, MaximumOrderLimit,CaseSize,UOM) {
        var id = "#Qtys" + e1;
        var value = $(id).val();
        var a;
        var intValue = parseInt(value);
        var processorder = true;
        if (intValue > 0) {
            if (MaximumOrderLimit != 0 && MaximumOrderLimit!=null && intValue> parseInt(MaximumOrderLimit)) {
                processorder=confirm("QUANTITY IS GREATER THAN MAXIMUM ORDER LIMIT.\n Are you sure want to order");
                if (!processorder) {
                    $(id).val(OriginalQuantity);
                }
                else {
                    $(".loader").show();
                    $.ajax({
                        url: "@Url.Action("UpdateDraftQuantity", "Order")",
                        type: "POST",
                        data: {
                            "ItemId": ItemId,
                            "Quantity": value
                        },
                        success: function (response) {
                            if (response) {
                                $(".loader").hide();
                            }
                        }
                    });
                }
            }
            else if (intValue < parseInt(CaseSize) && UOM == 'CASE') {
                alert("QUANTITY IS LESS THAN CASE SIZE.");
                $(id).val(OriginalQuantity);
            }
            else if (intValue < parseInt(MinimumOrderQuantity)) {
                alert("QUANTITY IS LESS THAN MOQ.");
                $(id).val(OriginalQuantity);
            }
            else {
                if (intValue < parseInt(MinimumOrderQuantity))
                {
                    $(".loader").show();
                    $.ajax({
                        url: "@Url.Action("UpdateDraftQuantity", "Order")",
                        type: "POST",
                        data: {
                            "ItemId": ItemId,
                            "Quantity": OriginalQuantity
                        },
                        success: function (response) {
                            if (response) {
                                $(".loader").hide();
                            }
                        }
                    });
                }
                else {
                    $.ajax({
                        url: "@Url.Action("UpdateDraftQuantity", "Order")",
                        type: "POST",
                        data: {
                            "ItemId": ItemId,
                            "Quantity": value
                        },
                        success: function (response) {
                            if (response) {
                                alert("ORDER QUANTITY UPDATED.");
                                $(id).val(parseInt(value));

                            }
                        }
                    });
                }
            }
        }
        else {
            alert("ORDER QUANTITY CANNOT BE LESS THAN OR ZERO.");
            $(id).val(parseInt(OriginalQuantity));
        }
        $(id).prop('disabled', true);
    }
    function Editbutton(e) {
        var qt = "#Qtys" + e;
        $(qt).attr("disabled", false);
        var qt = "#Qtys" + (e - 1);
        $(qt).attr("disabled", true);
        var qt = "#Qtys" + (e + 1);
        $(qt).attr("disabled", true);
    }
    function redirectPost(url, ErrorList, Token) {
        var form = document.createElement('form');
        document.body.appendChild(form);
        form.method = 'post';
        form.action = url;
        var input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'Errors'
        input.value = JSON.stringify(ErrorList)
        form.appendChild(input);
        form.submit();
    }
    function url_redirect(options) {
        var $form = $("<form />");

        $form.attr("action", options.url);
        $form.attr("method", options.method);

        for (var data in options.data)
            $form.append('<input type="hidden" name="' + data + '" value="' + options.data[data] + '" />');

        $("body").append($form);
        $form.submit();
    }
</script>